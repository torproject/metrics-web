<project name="ERNIE" basedir=".">

  <!--JSP specific build properties -->
  <property file="etc/build.properties"/>
  <property name="jsp-srcdir" value="src"/>
  <property name="jsp-webdir" value="war"/>
  <property name="jsp-libdir" value="${jsp-webdir}/WEB-INF/lib"/>
  <property name="jsp-builddir" value="${jsp-webdir}/WEB-INF/classes"/>
  <property name="jsp-name" value="ernie"/>
  <property name="jsp-confdir" value="etc"/>

  <path id="jsp-master-classpath">
    <fileset dir="${jsp-libdir}">
      <include name="*.jar"/>
    </fileset>
    <pathelement path="${jsp-builddir}"/>
  </path>

<!-- Usage target -->
  <target name="usage">
    <echo message=""/>
    <echo message="${jsp-name} JSP website build file"/>
    <echo message="-----------------------------------"/>
    <echo message=""/>

    <echo message="jsp-build      --> Build JSP website from jsp/"/>
    <echo message="jsp-deploy     --> Deploy JSP website (depends on jsp/etc/build.properties)"/>
    <echo message="jsp-war        --> Deploy JSP website in web archive (.war)"/>
    <echo message=""/>
  </target>

<!--JSP website-specific targets -->
  <target name="jsp-build" description="Build JSP application">
    <mkdir dir="${jsp-builddir}"/>
    <javac destdir="${jsp-builddir}"
            source="1.5"
            target="1.5" debug="true"
            deprecation="true"
            optimize="false"
            failonerror="true">
      <src path="${jsp-srcdir}"/>
      <classpath refid="jsp-master-classpath"/>
    </javac>
    <copy file="${jsp-confdir}/ernie.properties"
          todir="${jsp-builddir}" />
    <copy file="${jsp-confdir}/logging.properties"
          todir="${jsp-builddir}" />
  </target>

  <target name="jsp-deploy" depends="jsp-build" description="Deploy JSP application">
    <copy todir="${deploy.path}/${jsp-name}" preservelastmodified="true">
      <fileset dir="${jsp-webdir}">
        <include name="**/*.*"/>
      </fileset>
    </copy>
  </target>

  <target name="jsp-war" depends="jsp-build" description="Deploy JSP application as .war file">
    <war destfile="${jsp-name}.war"
      webxml="${jsp-webdir}/WEB-INF/web.xml">
      <fileset dir="${jsp-webdir}">
        <include name="**/*.*"/>
      </fileset>
    </war>
    <copy todir="${deploy.path}" file="${jsp-name}.war"
          preservelastmodified="true"/>
  </target>

  <!--Tomcat specific targets for application management-->
  <target name="reload" description="Reload application in Tomcat">
    <reload url="${tomcat.manager.url}"
            username="${tomcat.manager.username}"
            password="${tomcat.manager.password}"
            path="/${jsp-name}"/>
  </target>

  <target name="start" description="Start Tomcat application">
    <start url="${tomcat.manager.url}"
           username="${tomcat.manager.username}"
           password="${tomcat.manager.password}"
           path="/${jsp-name}"/>
  </target>

  <target name="stop" description="Stop Tomcat application">
    <stop url="${tomcat.manager.url}"
          username="${tomcat.manager.username}"
          password="${tomcat.manager.password}"
          path="/${jsp-name}"/>
  </target>

  <target name="list" description="List Tomcat applications">
    <list url="${tomcat.manager.url}"
          username="${tomcat.manager.username}"
          password="${tomcat.manager.password}"/>
  </target>

</project>
